<!DOCTYPE html>
<html lang='en'>
<head>
	<title>SpringRollCursor v0.2.0 API Documentation : src/EaselJSCursorPlugin.js</title>
	<meta charset='utf-8'>
	<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
	<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>
	<link rel='shortcut icon' type='image/png' href='../assets/images/favicon.ico?v=0.2.0'>
	<link href='//fonts.googleapis.com/css?family=Titillium+Web:300,200,600' rel='stylesheet' type='text/css'>
	<link rel='stylesheet' type='text/css' href='../assets/css/libraries.css?v=0.2.0'>
	<link rel='stylesheet' type='text/css' href='../assets/css/main.css?v=0.2.0'>
</head>
<body>
<header>
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class='container'>
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#docs-navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href='https://github.com/SpringRoll/Cursor'>
						<img src='../assets/images/logo.png?v=0.2.0' class="logo">
					<span class='project-name'>SpringRollCursor</span>
					<span class="sr-only">API Documentation for:</span>
					<span class='version hidden-xs'>v0.2.0</span>
				</a>
			</div>
			<div class="collapse navbar-collapse" id="docs-navbar">
	      <ul class="scope-toggles text-center nav navbar-nav navbar-right">
					<li><input class='scope-toggle' 
						id='toggle-inherited' 
						type='checkbox' 
						data-toggle='toggle' 
						data-on='Inherited' 
						data-off='Inherited' 
						data-size='mini'
						data-width='80'>
					</li>
					<li><input class='scope-toggle' 
						id='toggle-protected' 
						type='checkbox' 
						data-toggle='toggle' 
						data-on='Protected' 
						data-off='Protected' 
						data-size='mini'
						data-width='80'>
					</li>
					<li><input class='scope-toggle' 
						id='toggle-private' 
						type='checkbox' 
						data-toggle='toggle' 
						data-on='Private' 
						data-off='Private' 
						data-size='mini'
						data-width='80'>
					</li>
					<li><input class='scope-toggle' 
						id='toggle-deprecated' 
						type='checkbox' 
						data-toggle='toggle' 
						data-on='Deprecated' 
						data-off='Deprecated' 
						data-size='mini'
						data-width='80'>
					</li>
				</ul>
			</div>
		</div>
	</nav>
</header>
<div class='container'>
<div class='row'>
<nav id='sidebar' class='col-sm-4 col-md-3'>
<h2>APIs</h2>
<div class='input-group'>
  <div class='input-group-addon'>
    <span class='glyphicon glyphicon-search'></span>
  </div>
  <input type='search' class='form-control' id='api-filter' placeholder='Type to filter APIs'>
  <span class='collapsed btn-close glyphicon glyphicon-remove-sign hidden'></span>
</div>
<nav class='navbar navbar-default'>
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="btn-group" role="group" aria-label="...">
    <button type="button" class="sidebar-toggle collapsed btn btn-default" id='toggle-classes' data-target='#classes-collapse'>
      Classes
      <span class='collapsed glyphicon glyphicon-chevron-up'></span>
      <span class='expanded glyphicon glyphicon-chevron-down'></span>
    </button>
    <button type="button" class="sidebar-toggle collapsed btn btn-default" id='toggle-modules' data-target='#modules-collapse'>
      Modules
      <span class='collapsed glyphicon glyphicon-chevron-up'></span>
      <span class='expanded glyphicon glyphicon-chevron-down'></span>
    </button>
  </div>

  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class='collapse' id='classes-collapse'>
    <ul class='nav navbar-nav'>
        <li class='public'>
          <a href='../classes/springroll.Application.html'>springroll.Application</a>
        </li>
    </ul>
  </div>

  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class='collapse' id='modules-collapse'>
    <ul class='nav navbar-nav'>
    </ul>
  </div>
  <!-- /.container-fluid -->
</nav></nav>
<div class='col-sm-8 col-md-9'>
<div id='docs-main' class='apidocs'>
<h1 class="file-heading">File:EaselJSCursorPlugin.js</h1>

<div class="file">
<pre class="code prettyprint linenums">/**
 * @namespace springroll
 */
(function()
{
	// Include classes
	var ApplicationPlugin = include(&#x27;springroll.ApplicationPlugin&#x27;);
	var ListTask = include(&#x27;springroll.ListTask&#x27;);
	var Container = include(&#x27;createjs.Container&#x27;);
	var TextureAtlas = include(&#x27;springroll.easeljs.TextureAtlas&#x27;);
	var BitmapUtils = include(&#x27;springroll.easeljs.BitmapUtils&#x27;);
	var Bitmap = include(&#x27;createjs.Bitmap&#x27;);

	/**
	 * Plugin for EaselJS Cursor to the SpringRoll Application. All these
	 * properties and methods are automatically added to new Applications
	 * when this dependency is included in a project. 
	 * @class Application
	 */
	var plugin = new ApplicationPlugin();

	// Init the Keyboard
	plugin.setup = function()
	{
		/**
		 *	The cursor settings to use for a custom cursor.
		 *	@property {Object} options.cursorSettings
		 */
		this.options.add(&quot;cursorSettings&quot;, null, true);
		
		// ensure that keepMouseover is true, so that the cursor can continue to move during
		// state transitions
		if (this.options._options.displayOptions)
			this.options._options.displayOptions.keepMouseover = true;
		
		/**
		 * The url to a JSON file describing the atlas that cursor images can be found in.
		 * @property {String} options.cursorSettings.atlasData
		 * @default  null
		 */
		
		/**
		 * The url to a image file that cursor images can be found in.
		 * @property {String} options.cursorSettings.atlasImage
		 * @default  null
		 */
		
		/**
		 * The url to a image file that is the normal cursor. If atlasData and atlasImage are
		 * being used, this is the frame/sprite name instead.
		 * @property {String} options.cursorSettings.normal
		 * @default  null
		 */
		
		/**
		 * The url to a image file that is the pointer cursor. If atlasData and atlasImage are
		 * being used, this is the frame/sprite name instead.
		 * @property {String} options.cursorSettings.pointer
		 * @default  null
		 */
		
		/**
		 * The origin for the normal cursor state. The default is the center of the art.
		 * @property {Object} options.cursorSettings.normalOrigin
		 * @default  null
		 */
		
		/**
		 * The origin for the pointer cursor state. The default is the center of the art.
		 * @property {Object} options.cursorSettings.pointerOrigin
		 * @default  null
		 */
		
		/**
		 * The container for the cursor object
		 * @property {createjs.Container} cursor
		 * @default  null
		 */
		this.cursor = null;

		/**
		 * The image for the default cursor display
		 * @property {createjs.Bitmap} cursorNormal
		 * @private
		 * @default  null
		 */
		this._cursorNormal = null;

		/**
		 * The image for the cursor pointer display
		 * @property {createjs.Bitmap} cursorPointer
		 * @private
		 * @default  null
		 */
		this._cursorPointer = null;

		/**
		 * Handler when the mouse leaves the stage
		 * @method _stageOut
		 * @private
		 * @default  null
		 */
		this._stageOut = null;

		/**
		 * Handler when the mouse enters the stage
		 * @method _stageIn
		 * @private
		 * @default  null
		 */
		this._stageIn = null;

		/**
		 * Handler when the mouse moves over the stage
		 * @method _onMouseMove
		 * @private
		 * @default  null
		 */
		this._onMouseMove = null;

		/**
		 * Handler when the cursor changes
		 * @method _stageOut
		 * @private
		 * @default  null
		 */
		this._onCursorChange = null;
		
		// don&#x27;t do anything on mobile
		if (this.hasTouch) return;
		
		// load assets during the standard loading phase from ConfigPlugin
		this.once(&quot;loading&quot;, loadAssets.bind(this));
	};
	
	function loadAssets(assets)
	{
		// don&#x27;t do anything on mobile
		if (this.hasTouch) return;
		
		var options = this.options.cursorSettings;

		if (!options) return;
		
		var cursorAssets;
		if (options.atlasData &amp;&amp; options.atlasImage)
		{
			cursorAssets = {
				id: &#x27;cursorAtlas&#x27;,
				atlas: options.atlasData,
				image: options.atlasImage
			};
		}
		else
		{
			cursorAssets = {
				cursorNormal: options.normal,
				cursorPointer: options.pointer
			};
		}
		assets.push({
			id: &#x27;CursorAssets&#x27;,
			assets: [cursorAssets],
			complete: onAssetsLoaded.bind(this)
		});
	}
	
	function onAssetsLoaded(results)
	{
		// don&#x27;t do anything on mobile
		if (this.hasTouch) return;
		
		// Setup binds
		this._stageOut = stageOut.bind(this);
		this._stageIn = stageIn.bind(this);
		this._onMouseMove = onMouseMove.bind(this);
		this._onCursorChange = onCursorChange.bind(this);
		
		// Add the stage listeners
		var stage = this.display.stage;
		stage.addEventListener(&quot;mouseleave&quot;, this._stageOut);
		stage.addEventListener(&quot;mouseenter&quot;, this._stageIn);
		stage.addEventListener(&quot;stagemousemove&quot;, this._onMouseMove);
		stage.addEventListener(&quot;changecursor&quot;, this._onCursorChange);

		// hide the OS cursor
		this.display.canvas.style.cursor = &quot;none&quot;;

		//Create the cursor
		var options = this.options.cursorSettings;

		// Create local vars
		var cursor = new Container();
		var cursorAtlas = results.cursorAtlas || null;
		var cursorNormal;
		var cursorPointer;

		if (cursorAtlas)
		{
			cursorNormal = BitmapUtils.bitmapFromTexture(
				cursorAtlas.getFrame(options.normal)
			);
			cursorPointer = BitmapUtils.bitmapFromTexture(
				cursorAtlas.getFrame(options.pointer)
			);
		}
		else
		{
			cursorNormal = new Bitmap(results.cursorNormal);
			cursorPointer = new Bitmap(results.cursorPointer);
		}

		// set up origin of art
		if (options.normalOrigin)
		{
			// specified setting
			cursorNormal.regX = options.normalOrigin.x;
			cursorNormal.regY = options.normalOrigin.y;
		}
		else if (cursorAtlas)
		{
			// boundaries defined by frame
			cursorNormal.regX = cursorNormal.nominalBounds.width * 0.5;
			cursorNormal.regY = cursorNormal.nominalBounds.height * 0.5;
		}
		else
		{
			// boundaries defined by image size
			cursorNormal.regX = cursorNormal.image.width * 0.5;
			cursorNormal.regY = cursorNormal.image.height * 0.5;
		}
		if (options.pointerOrigin)
		{
			// specified setting
			cursorPointer.regX = options.pointerOrigin.x;
			cursorPointer.regY = options.pointerOrigin.y;
		}
		else if (cursorAtlas)
		{
			// boundaries defined by frame
			cursorPointer.regX = cursorPointer.nominalBounds.width * 0.5;
			cursorPointer.regY = cursorPointer.nominalBounds.height * 0.5;
		}
		else
		{
			// boundaries defined by image size
			cursorPointer.regX = cursorPointer.image.width * 0.5;
			cursorPointer.regY = cursorPointer.image.height * 0.5;
		}
		
		cursor.addChild(cursorNormal, cursorPointer);
		cursorPointer.visible = false;

		// Save as application properties
		this.cursor = cursor;
		this._cursorNormal = cursorNormal;
		this._cursorPointer = cursorPointer;
		
		stage.addChild(cursor);

		// ensure the cursor is still on top later on, 
		// when any states/panels have been added
		this.once(&quot;afterInit&quot;, function()
		{
			this.display.stage.addChild(this.cursor);
		}, -1);
	}
	
	function stageOut(ev)
	{
		if (this.cursor)
			this.cursor.visible = false;
	}
	
	function stageIn(ev)
	{
		if (this.cursor)
			this.cursor.visible = true;
	}
	
	function onMouseMove(ev)
	{
		this.cursor.x = ev.stageX;
		this.cursor.y = ev.stageY;
	}
	
	function onCursorChange(ev)
	{
		this._cursorPointer.visible = ev.cursor == &quot;pointer&quot;;
		this._cursorNormal.visible = ev.cursor != &quot;pointer&quot;;
	}

	// Destroy the animator
	plugin.teardown = function()
	{
		var cursor = this.cursor;

		if (cursor)
		{
			if (cursor.parent)
			{
				cursor.parent.removeChild(this.cursor);
			}
			cursor.removeAllChildren();
		}

		this.cursor = 
		this._cursorPointer = 
		this._cursorDefault = null;

		// Unlaod the assets
		this.unload(&#x27;CursorAssets&#x27;);
		
		var stage = this.display.stage;
		stage.removeEventListener(&quot;mouseleave&quot;, this._stageOut);
		stage.removeEventListener(&quot;mouseenter&quot;, this._stageIn);
		stage.removeEventListener(&quot;stagemousemove&quot;, this._onMouseMove);
		stage.removeEventListener(&quot;changecursor&quot;, this._onCursorChange);
		
		this._stageOut = 
		this._stageIn = 
		this._onMouseMove = 
		this._onCursorChange = null;
	};

}());</pre>
</div></div>
</div>
</div>
</div>
<script src='../assets/js/libraries.js?v=0.2.0'></script>
<script src='../assets/js/main.js?v=0.2.0'></script>
</body>
</html>